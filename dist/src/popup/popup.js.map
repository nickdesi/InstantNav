{"version":3,"file":"popup.js","sources":["../../../src/popup/popup.js"],"sourcesContent":["/**\n * InstantNav - Popup Logic\n */\n\nclass PopupController {\n    constructor() {\n        this.init();\n    }\n\n    async init() {\n        this.setupEventListeners();\n        await this.loadStats();\n        await this.loadMode();\n        await this.loadCurrentSite();\n    }\n\n    async loadStats() {\n        try {\n            const response = await chrome.runtime.sendMessage({ type: 'GET_STATS' });\n\n            if (response) {\n                document.getElementById('time-saved').textContent =\n                    this.formatTime(response.timeSaved || 0);\n\n                document.getElementById('prefetched').textContent =\n                    response.totalPrefetches || 0;\n\n                const precision = response.totalPrefetches > 0\n                    ? Math.round((response.successfulPredictions / response.totalPrefetches) * 100)\n                    : '--';\n                document.getElementById('precision').textContent =\n                    precision === '--' ? precision : `${precision}%`;\n            }\n        } catch (e) {\n            console.error('Failed to load stats:', e);\n        }\n    }\n\n    async loadMode() {\n        try {\n            const response = await chrome.runtime.sendMessage({ type: 'GET_MODE' });\n            const mode = response?.mode || 'auto';\n\n            document.querySelectorAll('.mode-btn').forEach(btn => {\n                btn.classList.toggle('active', btn.dataset.mode === mode);\n            });\n        } catch (e) {\n            console.error('Failed to load mode:', e);\n        }\n    }\n\n    async loadCurrentSite() {\n        try {\n            const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });\n            if (tab?.url) {\n                const url = new URL(tab.url);\n                document.getElementById('current-domain').textContent = url.hostname;\n\n                // Load trust level\n                const result = await chrome.storage.local.get('trustLevels');\n                const trustLevels = result.trustLevels || {};\n                const level = trustLevels[url.hostname] || 'neutral';\n                document.getElementById('trust-select').value = level;\n            }\n        } catch (e) {\n            console.error('Failed to load current site:', e);\n        }\n    }\n\n    setupEventListeners() {\n        // Enable toggle\n        document.getElementById('enabled-toggle').addEventListener('change', (e) => {\n            chrome.storage.local.set({ enabled: e.target.checked });\n        });\n\n        // Mode buttons\n        document.querySelectorAll('.mode-btn').forEach(btn => {\n            btn.addEventListener('click', () => {\n                const mode = btn.dataset.mode;\n                chrome.runtime.sendMessage({ type: 'SET_MODE', mode });\n\n                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));\n                btn.classList.add('active');\n            });\n        });\n\n        // Trust select\n        document.getElementById('trust-select').addEventListener('change', async (e) => {\n            const [tab] = await chrome.tabs.query({ active: true, currentWindow: true });\n            if (tab?.url) {\n                const hostname = new URL(tab.url).hostname;\n                const result = await chrome.storage.local.get('trustLevels');\n                const trustLevels = result.trustLevels || {};\n                trustLevels[hostname] = e.target.value;\n                await chrome.storage.local.set({ trustLevels });\n            }\n        });\n\n        // Dashboard button\n        document.getElementById('open-dashboard').addEventListener('click', () => {\n            chrome.tabs.create({ url: chrome.runtime.getURL('src/dashboard/dashboard.html') });\n        });\n\n        // Settings button\n        document.getElementById('open-settings').addEventListener('click', () => {\n            chrome.tabs.create({ url: chrome.runtime.getURL('src/dashboard/dashboard.html#settings') });\n        });\n    }\n\n    formatTime(ms) {\n        const seconds = ms / 1000;\n        if (seconds < 60) {\n            return `${seconds.toFixed(1)}s`;\n        }\n        const minutes = Math.floor(seconds / 60);\n        const remainingSeconds = seconds % 60;\n        return `${minutes}m ${remainingSeconds.toFixed(0)}s`;\n    }\n}\n\n// Initialize\nfunction init() {\n    new PopupController();\n}\n\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', init);\n} else {\n    init();\n}\n"],"names":["PopupController","response","precision","mode","btn","tab","url","level","b","hostname","trustLevels","ms","seconds","minutes","remainingSeconds","init"],"mappings":"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"}