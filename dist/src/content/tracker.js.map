{"version":3,"file":"tracker.js","sources":["../../../src/content/tracker.js"],"sourcesContent":["/**\n * InstantNav - Cursor Tracker\n * Tracks cursor position, velocity, and acceleration at 60fps\n * with intelligent throttling for heavy calculations\n */\n\nconst CAPTURE_INTERVAL = 16;  // ~60fps\nconst BATCH_INTERVAL = 80;    // Heavy calculations every 80ms\n\nclass CursorTracker {\n    constructor() {\n        this.position = { x: 0, y: 0 };\n        this.velocity = { vx: 0, vy: 0 };\n        this.acceleration = { ax: 0, ay: 0 };\n        this.direction = 0; // angle in radians\n\n        this.lastPosition = { x: 0, y: 0 };\n        this.lastVelocity = { vx: 0, vy: 0 };\n        this.lastTimestamp = performance.now();\n\n        this.listeners = new Set();\n        this.isTracking = false;\n\n        this._boundMouseMove = this._onMouseMove.bind(this);\n    }\n\n    start() {\n        if (this.isTracking) return;\n        this.isTracking = true;\n        document.addEventListener('mousemove', this._boundMouseMove, { passive: true });\n    }\n\n    stop() {\n        this.isTracking = false;\n        document.removeEventListener('mousemove', this._boundMouseMove);\n    }\n\n    subscribe(callback) {\n        this.listeners.add(callback);\n        return () => this.listeners.delete(callback);\n    }\n\n    _onMouseMove(event) {\n        const now = performance.now();\n        const dt = (now - this.lastTimestamp) / 1000; // in seconds\n\n        if (dt < CAPTURE_INTERVAL / 1000) return; // Throttle to ~60fps\n\n        // Update position\n        this.position.x = event.clientX;\n        this.position.y = event.clientY;\n\n        // Calculate velocity (pixels per second)\n        this.velocity.vx = (this.position.x - this.lastPosition.x) / dt;\n        this.velocity.vy = (this.position.y - this.lastPosition.y) / dt;\n\n        // Calculate acceleration\n        this.acceleration.ax = (this.velocity.vx - this.lastVelocity.vx) / dt;\n        this.acceleration.ay = (this.velocity.vy - this.lastVelocity.vy) / dt;\n\n        // Calculate direction (angle in radians)\n        this.direction = Math.atan2(this.velocity.vy, this.velocity.vx);\n\n        // Store for next frame\n        this.lastPosition = { ...this.position };\n        this.lastVelocity = { ...this.velocity };\n        this.lastTimestamp = now;\n\n        // Notify listeners\n        const data = this.getData();\n        this.listeners.forEach(cb => cb(data));\n    }\n\n    getData() {\n        return {\n            position: { ...this.position },\n            velocity: { ...this.velocity },\n            acceleration: { ...this.acceleration },\n            direction: this.direction,\n            speed: Math.sqrt(this.velocity.vx ** 2 + this.velocity.vy ** 2),\n            isDecelerating: this._isDecelerating(),\n            timestamp: performance.now()\n        };\n    }\n\n    _isDecelerating() {\n        // Check if cursor is slowing down (approaching target)\n        const currentSpeed = Math.sqrt(this.velocity.vx ** 2 + this.velocity.vy ** 2);\n        const prevSpeed = Math.sqrt(this.lastVelocity.vx ** 2 + this.lastVelocity.vy ** 2);\n        return currentSpeed < prevSpeed * 0.8; // 20% slower = decelerating\n    }\n\n    /**\n     * Calculate intention vector towards a target point\n     * Returns dot product (1 = moving directly towards, -1 = moving away)\n     */\n    getIntentionScore(targetX, targetY) {\n        const dx = targetX - this.position.x;\n        const dy = targetY - this.position.y;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n\n        if (distance === 0) return 1; // Already on target\n\n        // Normalize vectors\n        const toTargetX = dx / distance;\n        const toTargetY = dy / distance;\n\n        const speed = Math.sqrt(this.velocity.vx ** 2 + this.velocity.vy ** 2);\n        if (speed === 0) return 0; // Not moving\n\n        const velocityX = this.velocity.vx / speed;\n        const velocityY = this.velocity.vy / speed;\n\n        // Dot product: 1 = same direction, -1 = opposite\n        return toTargetX * velocityX + toTargetY * velocityY;\n    }\n}\n\n// Global instance\nwindow.instantNavTracker = new CursorTracker();\nwindow.instantNavTracker.start();\n\nconsole.log('[InstantNav] Cursor Tracker initialized');\n\n// Measure page load metrics for \"Time Saved\" stat\nfunction measurePageMetrics() {\n    // Wait for load event to ensure performance data is complete\n    window.addEventListener('load', () => {\n        setTimeout(() => {\n            try {\n                const navEntry = performance.getEntriesByType('navigation')[0];\n                const loadTime = navEntry ? navEntry.loadEventEnd : 0;\n\n                if (loadTime > 0) {\n                    chrome.runtime.sendMessage({\n                        type: 'NAVIGATION_COMPLETE',\n                        url: window.location.href,\n                        loadTime: Math.round(loadTime)\n                    });\n                }\n            } catch (e) {\n                // Ignore errors\n            }\n        }, 0);\n    });\n}\n\nmeasurePageMetrics();\n"],"names":["CursorTracker","callback","event","now","dt","data","cb","currentSpeed","prevSpeed","targetX","targetY","dx","dy","distance","toTargetX","toTargetY","speed","velocityX","velocityY","measurePageMetrics","navEntry","loadTime"],"mappings":"yBASA,MAAMA,CAAc,CAChB,aAAc,CACV,KAAK,SAAW,CAAE,EAAG,EAAG,EAAG,CAAC,EAC5B,KAAK,SAAW,CAAE,GAAI,EAAG,GAAI,CAAC,EAC9B,KAAK,aAAe,CAAE,GAAI,EAAG,GAAI,CAAC,EAClC,KAAK,UAAY,EAEjB,KAAK,aAAe,CAAE,EAAG,EAAG,EAAG,CAAC,EAChC,KAAK,aAAe,CAAE,GAAI,EAAG,GAAI,CAAC,EAClC,KAAK,cAAgB,YAAY,IAAG,EAEpC,KAAK,UAAY,IAAI,IACrB,KAAK,WAAa,GAElB,KAAK,gBAAkB,KAAK,aAAa,KAAK,IAAI,CACtD,CAEA,OAAQ,CACA,KAAK,aACT,KAAK,WAAa,GAClB,SAAS,iBAAiB,YAAa,KAAK,gBAAiB,CAAE,QAAS,GAAM,EAClF,CAEA,MAAO,CACH,KAAK,WAAa,GAClB,SAAS,oBAAoB,YAAa,KAAK,eAAe,CAClE,CAEA,UAAUC,EAAU,CAChB,YAAK,UAAU,IAAIA,CAAQ,EACpB,IAAM,KAAK,UAAU,OAAOA,CAAQ,CAC/C,CAEA,aAAaC,EAAO,CAChB,MAAMC,EAAM,YAAY,IAAG,EACrBC,GAAMD,EAAM,KAAK,eAAiB,IAExC,GAAIC,EAAK,GAAmB,IAAM,OAGlC,KAAK,SAAS,EAAIF,EAAM,QACxB,KAAK,SAAS,EAAIA,EAAM,QAGxB,KAAK,SAAS,IAAM,KAAK,SAAS,EAAI,KAAK,aAAa,GAAKE,EAC7D,KAAK,SAAS,IAAM,KAAK,SAAS,EAAI,KAAK,aAAa,GAAKA,EAG7D,KAAK,aAAa,IAAM,KAAK,SAAS,GAAK,KAAK,aAAa,IAAMA,EACnE,KAAK,aAAa,IAAM,KAAK,SAAS,GAAK,KAAK,aAAa,IAAMA,EAGnE,KAAK,UAAY,KAAK,MAAM,KAAK,SAAS,GAAI,KAAK,SAAS,EAAE,EAG9D,KAAK,aAAe,CAAE,GAAG,KAAK,QAAQ,EACtC,KAAK,aAAe,CAAE,GAAG,KAAK,QAAQ,EACtC,KAAK,cAAgBD,EAGrB,MAAME,EAAO,KAAK,QAAO,EACzB,KAAK,UAAU,QAAQC,GAAMA,EAAGD,CAAI,CAAC,CACzC,CAEA,SAAU,CACN,MAAO,CACH,SAAU,CAAE,GAAG,KAAK,QAAQ,EAC5B,SAAU,CAAE,GAAG,KAAK,QAAQ,EAC5B,aAAc,CAAE,GAAG,KAAK,YAAY,EACpC,UAAW,KAAK,UAChB,MAAO,KAAK,KAAK,KAAK,SAAS,IAAM,EAAI,KAAK,SAAS,IAAM,CAAC,EAC9D,eAAgB,KAAK,gBAAe,EACpC,UAAW,YAAY,IAAG,CACtC,CACI,CAEA,iBAAkB,CAEd,MAAME,EAAe,KAAK,KAAK,KAAK,SAAS,IAAM,EAAI,KAAK,SAAS,IAAM,CAAC,EACtEC,EAAY,KAAK,KAAK,KAAK,aAAa,IAAM,EAAI,KAAK,aAAa,IAAM,CAAC,EACjF,OAAOD,EAAeC,EAAY,EACtC,CAMA,kBAAkBC,EAASC,EAAS,CAChC,MAAMC,EAAKF,EAAU,KAAK,SAAS,EAC7BG,EAAKF,EAAU,KAAK,SAAS,EAC7BG,EAAW,KAAK,KAAKF,EAAKA,EAAKC,EAAKA,CAAE,EAE5C,GAAIC,IAAa,EAAG,MAAO,GAG3B,MAAMC,EAAYH,EAAKE,EACjBE,EAAYH,EAAKC,EAEjBG,EAAQ,KAAK,KAAK,KAAK,SAAS,IAAM,EAAI,KAAK,SAAS,IAAM,CAAC,EACrE,GAAIA,IAAU,EAAG,MAAO,GAExB,MAAMC,EAAY,KAAK,SAAS,GAAKD,EAC/BE,EAAY,KAAK,SAAS,GAAKF,EAGrC,OAAOF,EAAYG,EAAYF,EAAYG,CAC/C,CACJ,CAGA,OAAO,kBAAoB,IAAIlB,EAC/B,OAAO,kBAAkB,MAAK,EAE9B,QAAQ,IAAI,yCAAyC,EAGrD,SAASmB,GAAqB,CAE1B,OAAO,iBAAiB,OAAQ,IAAM,CAClC,WAAW,IAAM,CACb,GAAI,CACA,MAAMC,EAAW,YAAY,iBAAiB,YAAY,EAAE,CAAC,EACvDC,EAAWD,EAAWA,EAAS,aAAe,EAEhDC,EAAW,GACX,OAAO,QAAQ,YAAY,CACvB,KAAM,sBACN,IAAK,OAAO,SAAS,KACrB,SAAU,KAAK,MAAMA,CAAQ,CACrD,CAAqB,CAET,MAAY,CAEZ,CACJ,EAAG,CAAC,CACR,CAAC,CACL,CAEAF,EAAkB"}