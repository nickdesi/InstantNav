{"version":3,"file":"visual-feedback.js","sources":["../../../src/content/visual-feedback.js"],"sourcesContent":["/**\n * InstantNav - Visual Feedback\n * Ghost highlight effect on links being prefetched\n */\n\nclass VisualFeedback {\n    constructor() {\n        this.enabled = true;\n        this.highlightedLinks = new Map(); // element -> { overlay, score }\n        this.styleSheet = null;\n\n        this._injectStyles();\n        this._loadSettings();\n    }\n\n    _injectStyles() {\n        this.styleSheet = document.createElement('style');\n        this.styleSheet.textContent = `\n      .instantnav-ghost-highlight {\n        position: absolute;\n        pointer-events: none;\n        border-radius: 4px;\n        background: linear-gradient(135deg, \n          rgba(99, 102, 241, 0.08) 0%, \n          rgba(168, 85, 247, 0.08) 100%);\n        box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.1);\n        transition: opacity 0.2s ease-out, transform 0.15s ease-out;\n        z-index: 9998;\n      }\n      \n      .instantnav-ghost-highlight.score-high {\n        background: linear-gradient(135deg, \n          rgba(34, 197, 94, 0.1) 0%, \n          rgba(16, 185, 129, 0.1) 100%);\n        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.15);\n      }\n      \n      .instantnav-ghost-highlight.score-max {\n        background: linear-gradient(135deg, \n          rgba(251, 191, 36, 0.12) 0%, \n          rgba(245, 158, 11, 0.12) 100%);\n        box-shadow: 0 0 0 1px rgba(251, 191, 36, 0.2);\n        animation: instantnav-pulse 1.5s ease-in-out infinite;\n      }\n      \n      @keyframes instantnav-pulse {\n        0%, 100% { opacity: 0.7; }\n        50% { opacity: 1; }\n      }\n    `;\n        document.head.appendChild(this.styleSheet);\n    }\n\n    async _loadSettings() {\n        try {\n            const result = await chrome.storage.local.get('visualFeedback');\n            this.enabled = result.visualFeedback !== false;\n        } catch {\n            this.enabled = true;\n        }\n    }\n\n    setEnabled(enabled) {\n        this.enabled = enabled;\n        chrome.storage.local.set({ visualFeedback: enabled });\n\n        if (!enabled) {\n            this.clearAll();\n        }\n    }\n\n    highlight(element, score) {\n        if (!this.enabled || score < 70) return; // Only show for high scores\n\n        // Check if already highlighted\n        if (this.highlightedLinks.has(element)) {\n            this._updateHighlight(element, score);\n            return;\n        }\n\n        const rect = element.getBoundingClientRect();\n        const overlay = document.createElement('div');\n        overlay.className = 'instantnav-ghost-highlight';\n\n        // Add score class\n        if (score >= 90) {\n            overlay.classList.add('score-max');\n        } else if (score >= 80) {\n            overlay.classList.add('score-high');\n        }\n\n        // Position overlay\n        overlay.style.position = 'absolute';\n        overlay.style.top = `${rect.top + window.scrollY - 2}px`;\n        overlay.style.left = `${rect.left + window.scrollX - 2}px`;\n        overlay.style.width = `${rect.width + 4}px`;\n        overlay.style.height = `${rect.height + 4}px`;\n\n        document.body.appendChild(overlay);\n\n        this.highlightedLinks.set(element, { overlay, score });\n    }\n\n    _updateHighlight(element, score) {\n        const data = this.highlightedLinks.get(element);\n        if (!data) return;\n\n        const { overlay } = data;\n        const rect = element.getBoundingClientRect();\n\n        // Update position\n        overlay.style.top = `${rect.top + window.scrollY - 2}px`;\n        overlay.style.left = `${rect.left + window.scrollX - 2}px`;\n        overlay.style.width = `${rect.width + 4}px`;\n        overlay.style.height = `${rect.height + 4}px`;\n\n        // Update score class\n        overlay.classList.remove('score-high', 'score-max');\n        if (score >= 90) {\n            overlay.classList.add('score-max');\n        } else if (score >= 80) {\n            overlay.classList.add('score-high');\n        }\n\n        data.score = score;\n    }\n\n    unhighlight(element) {\n        const data = this.highlightedLinks.get(element);\n        if (!data) return;\n\n        data.overlay.remove();\n        this.highlightedLinks.delete(element);\n    }\n\n    clearAll() {\n        for (const [element, data] of this.highlightedLinks) {\n            data.overlay.remove();\n        }\n        this.highlightedLinks.clear();\n    }\n\n    /**\n     * Update highlights based on prediction results\n     */\n    updateFromPredictions(predictions) {\n        if (!this.enabled) return;\n\n        // Remove highlights for links no longer in top predictions\n        const currentElements = new Set(predictions.map(p => p.element));\n\n        for (const [element, data] of this.highlightedLinks) {\n            if (!currentElements.has(element)) {\n                this.unhighlight(element);\n            }\n        }\n\n        // Add/update highlights for top predictions\n        for (const pred of predictions) {\n            if (pred.score >= 70) {\n                this.highlight(pred.element, pred.score);\n            }\n        }\n    }\n}\n\n// Global instance\nwindow.instantNavFeedback = new VisualFeedback();\n\nconsole.log('[InstantNav] Visual Feedback initialized');\n"],"names":["VisualFeedback","result","enabled","element","score","rect","overlay","data","predictions","currentElements","p","pred"],"mappings":"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"}